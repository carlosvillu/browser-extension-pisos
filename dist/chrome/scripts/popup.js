!function(){"use strict";var e={294:function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.ConfigService=void 0;class t{static STORAGE_KEY="investmentAnalysisConfig";static DEFAULT_CONFIG={expenseConfig:{propertyManagementMonthly:150,insuranceMonthly:50,propertyTaxMonthly:100,communityFees:60,vacancyMaintenanceRate:.05,maintenanceContingencyRate:.01},mortgageConfig:{loanToValueRatio:.8,managementFeesRate:.1,interestRate:2.45},profitabilityThresholds:{excellent:6,good:4,fair:2},displayOptions:{showBadges:!0,showModal:!0,showLoadingStates:!0}};async getConfig(){try{const e=(await chrome.storage.sync.get(t.STORAGE_KEY))[t.STORAGE_KEY];if(!e)return t.DEFAULT_CONFIG;const a=this.migrateOldConfig(e);return{...t.DEFAULT_CONFIG,...a}}catch(e){return console.error("Error loading config:",e),t.DEFAULT_CONFIG}}migrateOldConfig(e){if(e.expenseConfig&&e.expenseConfig.communityFeesWithGarage&&!e.expenseConfig.communityFees){const a=Math.round(((e.expenseConfig.communityFeesWithGarage||80)+(e.expenseConfig.communityFeesWithoutGarage||40))/2);e.expenseConfig.communityFees=a,delete e.expenseConfig.communityFeesWithGarage,delete e.expenseConfig.communityFeesWithoutGarage}return e}async updateConfig(e){try{const a={...await this.getConfig(),...e};await chrome.storage.sync.set({[t.STORAGE_KEY]:a})}catch(e){throw console.error("Error saving config:",e),e}}async resetToDefaults(){try{await chrome.storage.sync.set({[t.STORAGE_KEY]:t.DEFAULT_CONFIG})}catch(e){throw console.error("Error resetting config:",e),e}}}a.ConfigService=t},714:function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.LanguageService=void 0;class t{static SUPPORTED_LANGUAGES=["es","en","fr"];static DEFAULT_LANGUAGE="en";static LOCALE_MAP={es:"es-ES",en:"en-US",fr:"fr-FR"};currentLanguage=t.DEFAULT_LANGUAGE;messages={};initialized=!1;constructor(){this.loadMessages()}async initialize(){if(!this.initialized){try{const e=await chrome.storage.local.get(["language"]);if(e.language&&this.isValidLanguage(e.language))this.currentLanguage=e.language;else{const e=this.getBrowserLanguage();this.currentLanguage=this.isValidLanguage(e)?e:t.DEFAULT_LANGUAGE,await chrome.storage.local.set({language:this.currentLanguage})}}catch(e){console.warn("Error initializing language:",e),this.currentLanguage=t.DEFAULT_LANGUAGE}this.initialized=!0}}isValidLanguage(e){return t.SUPPORTED_LANGUAGES.includes(e)}static getSupportedLanguages(){return[...t.SUPPORTED_LANGUAGES]}getBrowserLanguage(){return"undefined"!=typeof chrome&&chrome.i18n&&chrome.i18n.getUILanguage?chrome.i18n.getUILanguage().split("-")[0]:navigator.language?.split("-")[0]||"en"}loadMessages(){this.messages.es={appName:"Análisis de Inversión Inmobiliaria",popupTitle:"Configuración - Análisis de Inversión",configurationTitle:"Configuración de Análisis",languageSelector:"Idioma",languageSpanish:"Español",languageEnglish:"Inglés",languageFrench:"Francés",estimatedExpensesTitle:"Gastos Estimados",propertyManagementLabel:"Gestión inmobiliaria (€)",monthlyFixedCost:"Coste mensual fijo",insuranceLabel:"Seguro (€)",ibiLabel:"IBI (€)",vacancyLabel:"Vacancia (%)",rentalPercentage:"% del alquiler",repairsLabel:"Reparaciones y contingencias (%)",repairsHelp:"% del alquiler para calentadores, averías, mejoras, etc.",communityLabel:"Comunidad (€)",communityHelp:"Gastos de comunidad mensual",mortgageConfigTitle:"Configuración de Hipoteca",financingLabel:"Financiación (%)",priceFinnancedPercentage:"% del precio financiado",interestLabel:"Interés (%)",annualTinHelp:"TIN anual de la hipoteca",managementFeesLabel:"Gastos de gestión (%)",managementFeesHelp:"% del precio de compra (notaría, registro, tasación, etc.)",profitabilityThresholdsTitle:"Umbrales de Rentabilidad",excellentLabel:"Excelente (%)",goodLabel:"Buena (%)",regularLabel:"Regular (%)",displayOptionsTitle:"Opciones de Visualización",showProfitabilityIndicators:"Mostrar indicadores de rentabilidad",allowDetailsModal:"Permitir modal de detalles",showLoadingStates:"Mostrar estados de carga",restoreButton:"Restaurar",saveButton:"Guardar",errorLoadingConfig:"Error al cargar la configuración",configSavedSuccessfully:"Configuración guardada correctamente",errorSavingConfig:"Error al guardar la configuración",configRestoredSuccessfully:"Configuración restaurada a valores por defecto",errorRestoringConfig:"Error al restaurar la configuración",analyzing:"Analizando...",noRentalData:"Sin datos de alquiler",analysisError:"Error en análisis",netProfitability:"Rentabilidad Neta:",excellentInvestment:"EXCELENTE INVERSIÓN",goodInvestment:"BUENA INVERSIÓN",regularInvestment:"INVERSIÓN REGULAR",badInvestment:"MALA INVERSIÓN",unknownInvestment:"DESCONOCIDO",investmentAnalysisTitle:"Análisis de Inversión",roomsSuffix:" hab.",sizeSuffix:"m²",purchasePrice:"Precio de compra",monthlyRentalEstimate:"Alquiler estimado mensual",monthlyExpensesEstimate:"Gastos mensuales estimados",grossAnnualProfitability:"Rentabilidad bruta anual",netAnnualProfitability:"Rentabilidad neta anual",riskLevel:"Nivel de riesgo: "},this.messages.en={appName:"Real Estate Investment Analysis",popupTitle:"Configuration - Investment Analysis",configurationTitle:"Analysis Configuration",languageSelector:"Language",languageSpanish:"Spanish",languageEnglish:"English",languageFrench:"French",estimatedExpensesTitle:"Estimated Expenses",propertyManagementLabel:"Property management (€)",monthlyFixedCost:"Monthly fixed cost",insuranceLabel:"Insurance (€)",ibiLabel:"Property tax (€)",vacancyLabel:"Vacancy (%)",rentalPercentage:"% of rental income",repairsLabel:"Repairs and contingencies (%)",repairsHelp:"% of rental for heating, breakdowns, improvements, etc.",communityLabel:"Community fees (€)",communityHelp:"Monthly community expenses",mortgageConfigTitle:"Mortgage Configuration",financingLabel:"Financing (%)",priceFinnancedPercentage:"% of price financed",interestLabel:"Interest (%)",annualTinHelp:"Annual mortgage interest rate",managementFeesLabel:"Management fees (%)",managementFeesHelp:"% of purchase price (notary, registry, appraisal, etc.)",profitabilityThresholdsTitle:"Profitability Thresholds",excellentLabel:"Excellent (%)",goodLabel:"Good (%)",regularLabel:"Regular (%)",displayOptionsTitle:"Display Options",showProfitabilityIndicators:"Show profitability indicators",allowDetailsModal:"Allow details modal",showLoadingStates:"Show loading states",restoreButton:"Restore",saveButton:"Save",errorLoadingConfig:"Error loading configuration",configSavedSuccessfully:"Configuration saved successfully",errorSavingConfig:"Error saving configuration",configRestoredSuccessfully:"Configuration restored to default values",errorRestoringConfig:"Error restoring configuration",analyzing:"Analyzing...",noRentalData:"No rental data",analysisError:"Analysis error",netProfitability:"Net Profitability:",excellentInvestment:"EXCELLENT INVESTMENT",goodInvestment:"GOOD INVESTMENT",regularInvestment:"REGULAR INVESTMENT",badInvestment:"BAD INVESTMENT",unknownInvestment:"UNKNOWN",investmentAnalysisTitle:"Investment Analysis",roomsSuffix:" rooms",sizeSuffix:"m²",purchasePrice:"Purchase price",monthlyRentalEstimate:"Monthly rental estimate",monthlyExpensesEstimate:"Monthly expenses estimate",grossAnnualProfitability:"Gross annual profitability",netAnnualProfitability:"Net annual profitability",riskLevel:"Risk level: "},this.messages.fr={appName:"Analyse d'Investissement Immobilier",popupTitle:"Configuration - Analyse d'Investissement",configurationTitle:"Configuration de l'Analyse",languageSelector:"Langue",languageSpanish:"Espagnol",languageEnglish:"Anglais",languageFrench:"Français",estimatedExpensesTitle:"Dépenses Estimées",propertyManagementLabel:"Gestion immobilière (€)",monthlyFixedCost:"Coût mensuel fixe",insuranceLabel:"Assurance (€)",ibiLabel:"Taxe foncière (€)",vacancyLabel:"Vacance (%)",rentalPercentage:"% du revenu locatif",repairsLabel:"Réparations et contingences (%)",repairsHelp:"% du loyer pour chauffage, pannes, améliorations, etc.",communityLabel:"Charges de copropriété (€)",communityHelp:"Charges mensuelles de copropriété",mortgageConfigTitle:"Configuration Hypothécaire",financingLabel:"Financement (%)",priceFinnancedPercentage:"% du prix financé",interestLabel:"Intérêt (%)",annualTinHelp:"Taux d'intérêt annuel de l'hypothèque",managementFeesLabel:"Frais de gestion (%)",managementFeesHelp:"% du prix d'achat (notaire, registre, évaluation, etc.)",profitabilityThresholdsTitle:"Seuils de Rentabilité",excellentLabel:"Excellent (%)",goodLabel:"Bon (%)",regularLabel:"Régulier (%)",displayOptionsTitle:"Options d'Affichage",showProfitabilityIndicators:"Afficher les indicateurs de rentabilité",allowDetailsModal:"Permettre le modal de détails",showLoadingStates:"Afficher les états de chargement",restoreButton:"Restaurer",saveButton:"Sauvegarder",errorLoadingConfig:"Erreur lors du chargement de la configuration",configSavedSuccessfully:"Configuration sauvegardée avec succès",errorSavingConfig:"Erreur lors de la sauvegarde de la configuration",configRestoredSuccessfully:"Configuration restaurée aux valeurs par défaut",errorRestoringConfig:"Erreur lors de la restauration de la configuration",analyzing:"Analyse en cours...",noRentalData:"Aucune donnée locative",analysisError:"Erreur d'analyse",netProfitability:"Rentabilité Nette:",excellentInvestment:"EXCELLENT INVESTISSEMENT",goodInvestment:"BON INVESTISSEMENT",regularInvestment:"INVESTISSEMENT RÉGULIER",badInvestment:"MAUVAIS INVESTISSEMENT",unknownInvestment:"INCONNU",investmentAnalysisTitle:"Analyse d'Investissement",roomsSuffix:" pièces",sizeSuffix:"m²",purchasePrice:"Prix d'achat",monthlyRentalEstimate:"Estimation du loyer mensuel",monthlyExpensesEstimate:"Estimation des dépenses mensuelles",grossAnnualProfitability:"Rentabilité annuelle brute",netAnnualProfitability:"Rentabilité annuelle nette",riskLevel:"Niveau de risque: "}}async setLanguage(e){if(this.isValidLanguage(e)){this.currentLanguage=e;try{await chrome.storage.local.set({language:e}),this.notifyLanguageChange(e)}catch(e){console.warn("Error saving language preference:",e)}}}notifyLanguageChange(e){chrome.tabs.query({active:!0,currentWindow:!0},(a=>{const t=a[0];t?.id&&t.url?(console.log("Current tab URL:",t.url),t.url.includes("idealista.com")?(console.log("Sending language change message to Idealista tab. Language:",e),chrome.tabs.sendMessage(t.id,{type:"LANGUAGE_CHANGED",language:e}).then((()=>{console.log("Language change message sent successfully")})).catch((e=>{console.warn("Error sending language change message:",e)}))):console.log("Not an Idealista tab, skipping message send")):console.warn("No active tab found or tab has no URL")}))}getLanguage(){return this.currentLanguage}async loadLanguageFromStorage(){try{const e=await chrome.storage.local.get(["language"]);e.language&&this.isValidLanguage(e.language)&&(this.currentLanguage=e.language)}catch(e){console.warn("Error loading language from storage:",e)}}getMessage(e){return this.messages[this.currentLanguage]?.[e]||e}formatCurrency(e,a="EUR"){try{const n=t.LOCALE_MAP[this.currentLanguage]||t.LOCALE_MAP[t.DEFAULT_LANGUAGE];return new Intl.NumberFormat(n,{style:"currency",currency:a,minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}catch(a){return console.warn("Error formatting currency:",a),`${e.toLocaleString()}€`}}formatPercentage(e,a=2){try{const n=t.LOCALE_MAP[this.currentLanguage]||t.LOCALE_MAP[t.DEFAULT_LANGUAGE];return new Intl.NumberFormat(n,{style:"percent",minimumFractionDigits:a,maximumFractionDigits:a}).format(e/100)}catch(t){return console.warn("Error formatting percentage:",t),`${e.toFixed(a)}%`}}}a.LanguageService=t}},a={};function t(n){var i=a[n];if(void 0!==i)return i.exports;var s=a[n]={exports:{}};return e[n](s,s.exports,t),s.exports}!function(){const e=t(294),a=t(714);class n{configService;languageService;form;statusMessage;constructor(){this.configService=new e.ConfigService,this.languageService=new a.LanguageService,this.form=document.getElementById("configForm"),this.statusMessage=document.getElementById("statusMessage"),this.initialize()}async initialize(){await this.languageService.initialize(),await this.setupLanguage(),this.localizeUI(),await this.loadConfig(),this.attachEventListeners()}async setupLanguage(){const e=this.languageService.getLanguage(),a=document.getElementById("languageSelector");a&&(a.value=e)}async loadConfig(){try{const e=await this.configService.getConfig();this.populateForm(e)}catch(e){this.showStatus(this.languageService.getMessage("errorLoadingConfig"),"error")}}populateForm(e){const a={propertyManagement:document.getElementById("propertyManagement"),insurance:document.getElementById("insurance"),propertyTax:document.getElementById("propertyTax"),communityFees:document.getElementById("communityFees"),vacancyMaintenance:document.getElementById("vacancyMaintenance"),maintenanceContingency:document.getElementById("maintenanceContingency"),loanToValue:document.getElementById("loanToValue"),interestRate:document.getElementById("interestRate"),managementFees:document.getElementById("managementFees"),excellentThreshold:document.getElementById("excellentThreshold"),goodThreshold:document.getElementById("goodThreshold"),fairThreshold:document.getElementById("fairThreshold"),showBadges:document.getElementById("showBadges"),showModal:document.getElementById("showModal"),showLoadingStates:document.getElementById("showLoadingStates")};a.propertyManagement.value=e.expenseConfig.propertyManagementMonthly.toString(),a.insurance.value=e.expenseConfig.insuranceMonthly.toString(),a.propertyTax.value=e.expenseConfig.propertyTaxMonthly.toString(),a.communityFees.value=e.expenseConfig.communityFees.toString(),a.vacancyMaintenance.value=(100*e.expenseConfig.vacancyMaintenanceRate).toString(),a.maintenanceContingency.value=(100*e.expenseConfig.maintenanceContingencyRate).toString(),a.loanToValue.value=(100*e.mortgageConfig.loanToValueRatio).toString(),a.interestRate.value=e.mortgageConfig.interestRate.toString(),a.managementFees.value=(100*e.mortgageConfig.managementFeesRate).toString(),a.excellentThreshold.value=e.profitabilityThresholds.excellent.toString(),a.goodThreshold.value=e.profitabilityThresholds.good.toString(),a.fairThreshold.value=e.profitabilityThresholds.fair.toString(),a.showBadges.checked=e.displayOptions.showBadges,a.showModal.checked=e.displayOptions.showModal,a.showLoadingStates.checked=e.displayOptions.showLoadingStates}attachEventListeners(){this.form.addEventListener("submit",this.handleSubmit.bind(this));const e=document.getElementById("resetButton");e?.addEventListener("click",this.handleReset.bind(this));const a=document.getElementById("languageSelector");a?.addEventListener("change",this.handleLanguageChange.bind(this))}async handleLanguageChange(e){const a=e.target.value;console.log("Popup: Language changed to:",a),await this.languageService.setLanguage(a),console.log("Popup: Language service updated"),this.localizeUI(),console.log("Popup: UI localized")}async handleSubmit(e){e.preventDefault();try{new FormData(this.form);const e=this.extractConfigFromForm();await this.configService.updateConfig(e),this.showStatus(this.languageService.getMessage("configSavedSuccessfully"),"success"),setTimeout((()=>{this.hideStatus()}),3e3)}catch(e){this.showStatus(this.languageService.getMessage("errorSavingConfig"),"error")}}async handleReset(){try{await this.configService.resetToDefaults(),await this.loadConfig(),this.showStatus(this.languageService.getMessage("configRestoredSuccessfully"),"success"),setTimeout((()=>{this.hideStatus()}),3e3)}catch(e){this.showStatus(this.languageService.getMessage("errorRestoringConfig"),"error")}}extractConfigFromForm(){const e=e=>{const a=document.getElementById(e);return a?.value||""},a=e=>{const a=document.getElementById(e);return a?.checked||!1};return{expenseConfig:{propertyManagementMonthly:Number.parseInt(e("propertyManagement")),insuranceMonthly:Number.parseInt(e("insurance")),propertyTaxMonthly:Number.parseInt(e("propertyTax")),communityFees:Number.parseInt(e("communityFees")),vacancyMaintenanceRate:Number.parseFloat(e("vacancyMaintenance"))/100,maintenanceContingencyRate:Number.parseFloat(e("maintenanceContingency"))/100},mortgageConfig:{loanToValueRatio:Number.parseFloat(e("loanToValue"))/100,interestRate:Number.parseFloat(e("interestRate")),managementFeesRate:Number.parseFloat(e("managementFees"))/100},profitabilityThresholds:{excellent:Number.parseFloat(e("excellentThreshold")),good:Number.parseFloat(e("goodThreshold")),fair:Number.parseFloat(e("fairThreshold"))},displayOptions:{showBadges:a("showBadges"),showModal:a("showModal"),showLoadingStates:a("showLoadingStates")}}}showStatus(e,a){this.statusMessage.textContent=e,this.statusMessage.className=`status-message status-${a}`,this.statusMessage.style.display="block"}hideStatus(){this.statusMessage.style.display="none"}localizeUI(){const e=document.getElementById("popup-title");e&&(e.textContent=this.languageService.getMessage("popupTitle")),document.querySelectorAll("[data-i18n]").forEach((e=>{const a=e.getAttribute("data-i18n");a&&(e.textContent=this.languageService.getMessage(a))})),Object.entries({"config-header-title":"configurationTitle","language-selector-label":"languageSelector","language-option-es":"languageSpanish","language-option-en":"languageEnglish","language-option-fr":"languageFrench","expenses-title":"estimatedExpensesTitle","property-management-label":"propertyManagementLabel","property-management-help":"monthlyFixedCost","insurance-label":"insuranceLabel","insurance-help":"monthlyFixedCost","property-tax-label":"ibiLabel","property-tax-help":"monthlyFixedCost","vacancy-label":"vacancyLabel","vacancy-help":"rentalPercentage","maintenance-contingency-label":"repairsLabel","maintenance-contingency-help":"repairsHelp","community-fees-label":"communityLabel","community-fees-help":"communityHelp","mortgage-title":"mortgageConfigTitle","loan-to-value-label":"financingLabel","loan-to-value-help":"priceFinnancedPercentage","interest-rate-label":"interestLabel","interest-rate-help":"annualTinHelp","management-fees-label":"managementFeesLabel","management-fees-help":"managementFeesHelp","profitability-thresholds-title":"profitabilityThresholdsTitle","excellent-threshold-label":"excellentLabel","good-threshold-label":"goodLabel","fair-threshold-label":"regularLabel","display-options-title":"displayOptionsTitle","show-badges-label":"showProfitabilityIndicators","show-modal-label":"allowDetailsModal","show-loading-states-label":"showLoadingStates","save-button":"saveButton"}).forEach((([e,a])=>{const t=document.getElementById(e);t&&(t.textContent=this.languageService.getMessage(a))}));const a=document.getElementById("resetButton");a&&(a.textContent=this.languageService.getMessage("restoreButton"))}}document.addEventListener("DOMContentLoaded",(()=>{new n}))}()}();