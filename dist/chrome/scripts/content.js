!function(){"use strict";var e={16:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.RentalDataAnalyzer=void 0,t.RentalDataAnalyzer=class{logger;propertyExtractor;constructor(e,t){this.logger=e,this.propertyExtractor=t}async fetchRentalData(e){try{this.logger.log(`Fetching rental data from: ${e}`);const t=await fetch(e,{method:"GET",headers:{Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Language":"es-ES,es;q=0.5","User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36"}});if(!t.ok)return this.logger.error(`Failed to fetch rental data: ${t.status}`),null;const n=await t.text();return this.parseRentalDataFromHtml(n)}catch(e){return this.logger.error("Error fetching rental data",e),null}}parseRentalDataFromHtml(e){try{const t=(new DOMParser).parseFromString(e,"text/html"),n=this.propertyExtractor.extractPropertiesFromDocument(t);if(0===n.length)return this.logger.log("No rental properties found in response"),null;const r=n.map((e=>e.price)).filter((e=>e>0)).sort(((e,t)=>e-t));if(0===r.length)return this.logger.log("No valid prices found in rental properties"),null;const a=r.reduce(((e,t)=>e+t),0)/r.length,i=r[0],o=r[r.length-1];return this.logger.log(`Rental analysis: ${r.length} properties, avg: ${a}â‚¬`),{averagePrice:Math.round(a),minPrice:i,maxPrice:o,sampleSize:r.length,properties:n}}catch(e){return this.logger.error("Error parsing rental data from HTML",e),null}}}},169:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ProfitabilityCalculator=void 0,t.ProfitabilityCalculator=class{logger;config;DEFAULT_CONFIG={propertyManagementRate:.09,insuranceRate:.002,propertyTaxRate:.007,communityFeesWithGarage:80,communityFeesWithoutGarage:40,vacancyMaintenanceRate:.05};constructor(e,t={}){this.logger=e,this.config=t,this.config={...this.DEFAULT_CONFIG,...t}}calculateProfitability(e,t){const n=t.averagePrice,r=12*n,a=e.price,i=r/a*100,o=this.calculateMonthlyExpenses(e,n),s=r-12*o,l=Math.max(0,s/a*100),{recommendation:c,riskLevel:d}=this.evaluateInvestment(i,l,t.sampleSize);return this.logger.log(`Profitability calculation for ${e.id}: Gross ${i.toFixed(2)}%, Net ${l.toFixed(2)}%`),{propertyId:e.id,purchasePrice:a,estimatedRent:n,grossYield:Math.round(100*i)/100,netYield:Math.round(100*l)/100,monthlyExpenses:o,recommendation:c,riskLevel:d}}calculateMonthlyExpenses(e,t){let n=0;n+=t*this.config.propertyManagementRate;const r=e.price;return n+=r*this.config.insuranceRate/12,n+=r*this.config.propertyTaxRate/12,e.hasGarage||e.floor?.includes("ascensor")?n+=this.config.communityFeesWithGarage:n+=this.config.communityFeesWithoutGarage,n+=t*this.config.vacancyMaintenanceRate,Math.round(n)}evaluateInvestment(e,t,n){let r,a;return r=t>=6?"excellent":t>=4?"good":t>=2?"fair":"poor",a=n<3||e>8||t<1?"high":t>=3&&e<=7?"low":"medium",{recommendation:r,riskLevel:a}}}},273:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.IdealistaInvestmentAnalyzer=void 0;const r=n(530),a=n(516),i=n(922),o=n(16),s=n(169),l=n(841),c=n(677);t.IdealistaInvestmentAnalyzer=class{logger;urlAnalyzer;propertyExtractor;rentalDataAnalyzer;profitabilityCalculator;urlGenerator;uiRenderer;constructor(){this.logger=new r.Logger("IdealistaInvestmentAnalyzer"),this.urlAnalyzer=new a.UrlAnalyzer(this.logger),this.propertyExtractor=new i.PropertyExtractor(this.logger),this.rentalDataAnalyzer=new o.RentalDataAnalyzer(this.logger,this.propertyExtractor),this.profitabilityCalculator=new s.ProfitabilityCalculator(this.logger),this.urlGenerator=new l.CrossReferenceUrlGenerator(this.logger),this.uiRenderer=new c.InvestmentUIRenderer(this.logger)}initialize(){this.logger.log("Initializing Idealista Investment Analyzer"),this.urlAnalyzer.isIdealistaPropertyPage()?(this.logger.log("Idealista property page detected"),this.analyzeCurrentPage()):this.logger.log("Not an Idealista property page")}analyzeCurrentPage(){const e=this.urlAnalyzer.analyzeCurrentPage();e.searchType&&this.startPropertyAnalysis(e)}startPropertyAnalysis(e){this.logger.log(`Starting analysis for ${e.searchType} properties in ${e.location}`);const t=this.propertyExtractor.extractPropertiesFromPage();this.logger.log(`Found ${t.length} properties on page`),t.length>0&&this.processProperties(t,e)}async processProperties(e,t){if(this.logger.log("Processing properties for investment analysis"),"venta"===t.searchType)for(const n of e)await this.analyzePropertyProfitability(n,t),await this.delay(1e3);else this.logger.log("Skipping analysis - not a sale search")}async analyzePropertyProfitability(e,t){this.logger.log(`Analyzing property ${e.id}: ${e.price}â‚¬ - ${e.rooms} hab., ${e.size}mÂ²`);try{this.uiRenderer.renderLoadingBadge(e);const n=this.urlGenerator.generateRentalUrl(t.location,e);this.logger.log(`Fetching rental data from: ${n}`);const r=await this.rentalDataAnalyzer.fetchRentalData(n);if(r&&r.sampleSize>0){const t=this.profitabilityCalculator.calculateProfitability(e,r);this.logger.log(`Profitability analysis for ${e.id}:`,t),this.uiRenderer.renderBadge(e,t)}else this.logger.log(`No rental data found for property ${e.id}`),this.uiRenderer.removeBadge(e)}catch(t){this.logger.error(`Error analyzing property ${e.id}`,t),this.uiRenderer.removeBadge(e)}}delay(e){return new Promise((t=>setTimeout(t,e)))}}},516:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.UrlAnalyzer=void 0,t.UrlAnalyzer=class{logger;constructor(e){this.logger=e}analyzeCurrentPage(){window.location.href;const e=window.location.pathname,t=new URLSearchParams(window.location.search);let n=null;e.includes("/venta-viviendas/")?n="venta":e.includes("/alquiler-viviendas/")&&(n="alquiler");const r=this.extractLocationFromUrl(e),a=t.toString().length>0,i={isIdealista:this.isIdealistaPropertyPage(),searchType:n,location:r,hasFilters:a};return this.logger.log("URL Analysis:",i),i}isIdealistaPropertyPage(){const e=window.location.hostname,t=window.location.pathname;return"www.idealista.com"===e&&(t.includes("/venta-viviendas/")||t.includes("/alquiler-viviendas/"))}extractLocationFromUrl(e){const t=e.match(/\/(venta|alquiler)-viviendas\/([^/]+)/);return t?t[2]:null}}},530:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0,t.Logger=class{context;constructor(e){this.context=e}log(e,t){const n=`[${(new Date).toISOString()}][${this.context}]`;t?console.log(`${n} ${e}`,t):console.log(`${n} ${e}`)}error(e,t){const n=`[${(new Date).toISOString()}][${this.context}][ERROR]`;t?console.error(`${n} ${e}`,t):console.error(`${n} ${e}`)}}},677:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.InvestmentUIRenderer=void 0,t.InvestmentUIRenderer=class{logger;constructor(e){this.logger=e}renderBadge(e,t){const n=this.findPropertyElement(e.id);if(!n)return void this.logger.error(`Property element not found for ID: ${e.id}`);this.removeBadge(e);const r=this.createAnalysisButton(e,t),a=n.querySelector(".item-description");a?(a.parentNode?.insertBefore(r,a.nextSibling),this.logger.log(`Investment analysis button rendered for property ${e.id}: ${t.recommendation}`)):this.logger.error(`Description container not found for property ${e.id}`)}renderLoadingBadge(e){const t=this.findPropertyElement(e.id);if(!t)return;this.removeBadge(e);const n=document.createElement("div");n.className="investment-badge investment-badge--loading",n.setAttribute("data-property-id",e.id),n.textContent="Analyzing...";const r=t.querySelector(".item-multimedia");r&&(r.appendChild(n),this.logger.log(`Loading badge rendered for property ${e.id}`))}removeBadge(e){document.querySelectorAll(`[data-property-id="${e.id}"]`).forEach((e=>e.remove()))}findPropertyElement(e){return document.querySelector(`article.item[data-element-id="${e}"]`)}createAnalysisButton(e,t){const n=document.createElement("div");n.className="investment-analysis-container",n.setAttribute("data-property-id",t.propertyId);const r=document.createElement("button");return r.className=`investment-analysis-button investment-analysis-button--${t.recommendation}`,r.innerHTML=`\n      <div class="investment-analysis-button__content">\n        <div class="investment-analysis-button__yield">\n          <span class="investment-analysis-button__yield-label">Rentabilidad Neta:</span>\n          <span class="investment-analysis-button__yield-value">${t.netYield}%</span>\n        </div>\n        <div class="investment-analysis-button__recommendation">\n          ${this.getRecommendationText(t.recommendation)}\n        </div>\n        <div class="investment-analysis-button__icon">ðŸ“Š</div>\n      </div>\n    `,r.addEventListener("click",(n=>{n.preventDefault(),n.stopPropagation(),this.openAnalysisModal(e,t),this.logger.log(`Investment modal opened for property ${e.id}`)})),n.appendChild(r),n}openAnalysisModal(e,t){new n(this.logger).openModal(e,t)}getRecommendationText(e){switch(e){case"excellent":return"EXCELENTE INVERSIÃ“N";case"good":return"BUENA INVERSIÃ“N";case"fair":return"INVERSIÃ“N REGULAR";case"poor":return"MALA INVERSIÃ“N";default:return"DESCONOCIDO"}}};class n{logger;constructor(e){this.logger=e}openModal(e,t){const n=document.querySelector(".investment-modal-overlay");n&&n.remove();const r=document.createElement("div");r.className="investment-modal-overlay";const a=document.createElement("div");a.className="investment-modal",a.innerHTML=this.createModalContent(e,t),r.appendChild(a),document.body.appendChild(r),this.addEventListeners(a,r)}createModalContent(e,t){return`\n      <div class="investment-modal__header">\n        <h3 class="investment-modal__title">AnÃ¡lisis de InversiÃ³n</h3>\n        <button class="investment-modal__close">Ã—</button>\n      </div>\n      \n      <div class="investment-modal__content">\n        <div class="investment-modal__property-info">\n          <h4>${e.title}</h4>\n          <p class="investment-modal__property-details">\n            ${e.rooms?e.rooms+" hab.":""} \n            ${e.size?e.size+"mÂ²":""}\n            ${e.floor?" â€¢ "+e.floor:""}\n          </p>\n        </div>\n\n        <div class="investment-modal__analysis">\n          <div class="investment-modal__recommendation investment-modal__recommendation--${t.recommendation}">\n            <div class="investment-modal__recommendation-text">\n              ${this.getRecommendationText(t.recommendation)}\n            </div>\n            <div class="investment-modal__recommendation-yield">\n              Rentabilidad Neta: ${t.netYield}%\n            </div>\n          </div>\n\n          <div class="investment-modal__details-grid">\n            <div class="investment-modal__detail-item">\n              <span class="investment-modal__label">Precio de compra</span>\n              <span class="investment-modal__value">${t.purchasePrice.toLocaleString()}â‚¬</span>\n            </div>\n            \n            <div class="investment-modal__detail-item">\n              <span class="investment-modal__label">Alquiler estimado mensual</span>\n              <span class="investment-modal__value">${t.estimatedRent.toLocaleString()}â‚¬</span>\n            </div>\n            \n            <div class="investment-modal__detail-item">\n              <span class="investment-modal__label">Gastos mensuales estimados</span>\n              <span class="investment-modal__value">${t.monthlyExpenses.toLocaleString()}â‚¬</span>\n            </div>\n            \n            <div class="investment-modal__divider"></div>\n            \n            <div class="investment-modal__detail-item">\n              <span class="investment-modal__label">Rentabilidad bruta anual</span>\n              <span class="investment-modal__value">${t.grossYield}%</span>\n            </div>\n            \n            <div class="investment-modal__detail-item investment-modal__detail-item--highlight">\n              <span class="investment-modal__label">Rentabilidad neta anual</span>\n              <span class="investment-modal__value">${t.netYield}%</span>\n            </div>\n            \n            <div class="investment-modal__risk investment-modal__risk--${t.riskLevel}">\n              <div class="investment-modal__risk-dot"></div>\n              <span>Nivel de riesgo: ${t.riskLevel.toUpperCase()}</span>\n            </div>\n          </div>\n        </div>\n      </div>\n    `}addEventListeners(e,t){const n=e.querySelector(".investment-modal__close");n?.addEventListener("click",(()=>{t.remove()})),t.addEventListener("click",(e=>{e.target===t&&t.remove()}));const r=e=>{"Escape"===e.key&&(t.remove(),document.removeEventListener("keydown",r))};document.addEventListener("keydown",r)}getRecommendationText(e){switch(e){case"excellent":return"EXCELENTE INVERSIÃ“N";case"good":return"BUENA INVERSIÃ“N";case"fair":return"INVERSIÃ“N REGULAR";case"poor":return"MALA INVERSIÃ“N";default:return"DESCONOCIDO"}}}},841:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.CrossReferenceUrlGenerator=void 0,t.CrossReferenceUrlGenerator=class{logger;constructor(e){this.logger=e}generateRentalUrl(e,t){return this.buildUrl("https://www.idealista.com/alquiler-viviendas",e,t)}generateSaleUrl(e,t){return this.buildUrl("https://www.idealista.com/venta-viviendas",e,t)}buildUrl(e,t,n){if(!t)return this.logger.error("No location provided for URL generation"),`${e}/`;let r=`${e}/${t}/`;const a=new URLSearchParams;if(n.rooms&&n.rooms>0&&a.append("habitaciones",n.rooms.toString()),n.size&&n.size>0){const e=Math.max(1,n.size-20),t=n.size+20;a.append("superficie",`${e}-${t}`)}const i=a.toString();return i&&(r+=`?${i}`),r}}},922:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PropertyExtractor=void 0,t.PropertyExtractor=class{logger;constructor(e){this.logger=e}extractPropertiesFromPage(){const e=[],t=document.querySelectorAll("article.item[data-element-id]");return this.logger.log(`Found ${t.length} property elements on page`),t.forEach((t=>{try{const n=this.extractPropertyData(t);n&&e.push(n)}catch(e){this.logger.error("Error extracting property data",e)}})),e}extractPropertiesFromDocument(e){const t=[];return e.querySelectorAll("article.item[data-element-id]").forEach((e=>{try{const n=this.extractPropertyDataFromElement(e);n&&t.push(n)}catch(e){this.logger.error("Error extracting property data from element",e)}})),t}extractPropertyData(e){return this.extractPropertyDataFromElement(e)}extractPropertyDataFromElement(e){const t=e.getAttribute("data-element-id");if(!t)return null;const n=e.querySelector(".item-price"),r=n?.textContent?.replace(/[â‚¬\s]/g,"").replace(".","")||"0",a=parseInt(r,10)||0,i=e.querySelector(".item-link"),o=i?.textContent?.trim()||"",s=i?.href||"",l=e.querySelectorAll(".item-detail");let c=null,d=null,m=null;l.forEach((e=>{const t=e.textContent?.trim()||"";if(t.includes("hab.")){const e=t.match(/(\d+)\s*hab\./);c=e?parseInt(e[1],10):null}else if(t.includes("mÂ²")){const e=t.match(/(\d+)\s*mÂ²/);d=e?parseInt(e[1],10):null}else(t.includes("Planta")||t.includes("Bajo"))&&(m=t)}));const g=!!e.querySelector(".item-parking"),p=e.querySelector(".item-description .ellipsis"),u=p?.textContent?.trim()||"",h=e.querySelectorAll(".listing-tags"),v=Array.from(h).map((e=>e.textContent?.trim()||"")),y=this.extractLocationFromTitle(o);return{id:t,title:o,price:a,rooms:c,size:d,floor:m,hasGarage:g,description:u,url:s,tags:v,location:y}}extractLocationFromTitle(e){const t=e.split(",");return t.length>=2?t[t.length-2].trim():""}}}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}!function(){const e=n(273);"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{(new e.IdealistaInvestmentAnalyzer).initialize()})):(new e.IdealistaInvestmentAnalyzer).initialize()}()}();